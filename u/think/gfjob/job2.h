#include <ansi.h>

mapping *quest = ({
  ({
  (["name":                "江湖宵小",
    "where" :              "/quest/gfjob/npc/xiaoxiao",]), 
   (["name":                "山贼", 
    "where" :              "/quest/gfjob/npc/shanzei",]),
        (["name":                "花剑影", 
        "where" :                "/quest/gfjob/npc/hua",]), 
        (["name":                "金光上人", 
        "where" :                "/quest/gfjob/npc/shangren",]),       
    }), 
    ({
     (["name":                "山贼", 
    "where" :              "/quest/gfjob/npc/shanzei",]),
     (["name":                "盖一鸣",
     "where" :              "/quest/gfjob/npc/gaiyiming",]),
     (["name":                "常长风",
     "where" :              "/quest/gfjob/npc/chang",]),
      (["name":                "花剑影",
     "where" :                "/quest/gfjob/npc/hua",]),
      (["name":                "黄须道人",
     "where" :                "/quest/gfjob/npc/huangxu",]),
     (["name":                "恶僧",
     "where" :                "/quest/gfjob/npc/eseng",]),
      (["name":                "曹化淳",
     "where" :                "/quest/gfjob/npc/cao",]),
      (["name":                "朱安国",
     "where" :                "/quest/gfjob/npc/zhu",]),
        (["name":                "不平道人",
        "where" :                "/quest/gfjob/npc/daoren",]),     
        (["name":                "大盗",
        "where" :                "/quest/gfjob/npc/dadao1",]),  
        (["name":                "恶霸",
        "where" :                "/quest/gfjob/npc/eba",]),    
        (["name":                "小混混", 
        "where" :                "/quest/gfjob/npc/hunhun",]),   
      }), 
      ({
         (["name":                "江洋大盗 王三",
     "where" :                "/quest/gfjob/npc/dadao",]),
       (["name":                "草寇",
     "where" :                "/quest/gfjob/npc/caokou",]),
      (["name":                "恶霸",
     "where" :                "/quest/gfjob/npc/eba",]),
      (["name":                "宋扬",
     "where" :                 "/quest/gfjob/npc/songyang",]),
      (["name":               "全二风",
     "where" :                 "/quest/gfjob/npc/quan",]),
      (["name":               "孟正鹏",
     "where" :                 "/quest/gfjob/npc/meng",]),
      (["name":               "鲜于通",
     "where" :                 "/quest/gfjob/npc/xian",]),
      (["name":               "麦鲸",
     "where" :                 "/quest/gfjob/npc/maijing",]),
      (["name":               "过三拳",
     "where" :                 "/quest/gfjob/npc/guo",]),
        (["name":                "霍元风", 
        "where" :                "/quest/gfjob/npc/huo",]),     
        (["name":                "何清风", 
        "where" :                "/quest/gfjob/npc/qingfeng",]),    
        (["name":                "秦俊", 
        "where" :                "/quest/gfjob/npc/qinjun",]),    
        (["name":                "阎基", 
        "where" :                "/quest/gfjob/npc/yanji",]),    
        (["name":                "朱十九",
        "where" :                "/quest/gfjob/npc/zhu1",]),    
        (["name":                "宋涛",
        "where" :                "/quest/gfjob/npc/songtao",]),         
       }), 
      ({
      (["name":               "赵一伤",
     "where" :                 "/quest/gfjob/npc/zhaoyishang",]),   
      (["name":               "钱二败",
     "where" :                 "/quest/gfjob/npc/qian",]),    
      (["name":               "孙三毁",
     "where" :                 "/quest/gfjob/npc/sun",]),  
      (["name":               "李四摧",
     "where" :                 "/quest/gfjob/npc/li",]), 
      (["name":               "周五输",
     "where" :                 "/quest/gfjob/npc/zhou",]), 
      (["name":               "吴六破",
     "where" :                 "/quest/gfjob/npc/wu",]), 
      (["name":               "郑七灭",
     "where" :                 "/quest/gfjob/npc/zheng",]), 
      (["name":               "元广波",
     "where" :                 "/quest/gfjob/npc/yuan",]), 
      (["name":               "徐长老",
     "where" :                 "/quest/gfjob/npc/xu",]), 
      (["name":               "单正",
     "where" :                 "/quest/gfjob/npc/shan",]), 
      (["name":               "霍元风",
     "where" :                 "/quest/gfjob/npc/huo",]),
      }), 
      ({
      (["name":               "阿大",
     "where" :                 "/quest/gfjob/npc/ada",]),  
      (["name":               "阿二",
     "where" :                 "/quest/gfjob/npc/aer",]), 
      (["name":               "阿三",
     "where" :                 "/quest/gfjob/npc/asan",]), 
      (["name":               "玉真子",
     "where" :                 "/quest/gfjob/npc/yu",]),   
        (["name":                "南海鳄神",
        "where" :                "/quest/gfjob/npc/eshen",]),     
        (["name":                "叶二娘", 
        "where" :                "/quest/gfjob/npc/yeerniang",]),     
        (["name":                "云中鹤",
        "where" :                "/quest/gfjob/npc/yunzhonghe",]),     
     }),
     });
mapping *wheres=({
          
(["chinese": "武当",
"weizhi" : "/d/wudang/tufeiwo1",]), 
(["chinese": "武当",
"weizhi" : "/d/wudang/wdroad8",]), 
(["chinese": "武当",
"weizhi" : "/d/wudang/shijie22",]), 
(["chinese": "扬州",
"weizhi" : "/d/city/beimen",]), 
(["chinese": "扬州",
"weizhi" : "/d/city/nandajie1",]), 
(["chinese": "扬州",
"weizhi" : "/d/city/zuixianlou2",]), 
(["chinese": "神龙岛",
"weizhi" : "/d/shenlong/wuchang",]), 
(["chinese": "神龙岛",
"weizhi" : "/d/shenlong/kongdi",]), 
(["chinese": "日月",
"weizhi" : "/d/heimuya/road1",]), 
(["chinese": "日月",
"weizhi" : "/d/heimuya/xingxingtan",]), 
(["chinese": "日月",
"weizhi" : "/d/heimuya/shidao2",]), 
(["chinese": "北京",
"weizhi" : "/d/city2/road10",]), 
(["chinese": "北京",
"weizhi" : "/d/city2/xichang1",]), 
(["chinese": "北京",
"weizhi" : "/d/city2/xisi",]), 
(["chinese": "全真",
"weizhi" : "/d/quanzhen/shijie4",]), 
(["chinese": "全真",
"weizhi" : "d/quanzhen/guangchang",]), 
(["chinese": "全真",
"weizhi" : "/d/quanzhen/sheshentai",]), 
(["chinese": "明教",
"weizhi" : "/d/mj/luzhou",]), 
(["chinese": "明教",
"weizhi" : "/d/mj/shanlu2",]), 
(["chinese": "明教",
"weizhi" : "/d/mj/shanmen",]), 
(["chinese": "泰山",
"weizhi" : "/d/taishan/yidao1",]), 
(["chinese": "泰山",
"weizhi" : "d/taishan/doumo",]), 
(["chinese": "泰山",
"weizhi" : "/d/taishan/shijin",]), 
(["chinese": "泉州",
"weizhi" : "/d/quanzhou/jiaxing",]), 
(["chinese": "泉州",
"weizhi" : "/d/quanzhou/beimen",]), 
(["chinese": "泉州",
"weizhi" : "/d/quanzhou/nanhu",]), 
(["chinese": "峨嵋",
"weizhi" : "/d/emei/shijie10",]), 
(["chinese": "峨嵋",
"weizhi" : "/d/emei/shijie1",]), 
(["chinese": "峨嵋",
"weizhi" : "/d/emei/jietuo",]), 
(["chinese": "星宿",
"weizhi" : "/d/xingxiu/xxroad2",]), 
(["chinese": "星宿",
"weizhi" : "/d/xingxiu/tianroad3",]), 
(["chinese": "星宿",
"weizhi" : "/d/xingxiu/shamo2",]), 
(["chinese": "冰火岛",
"weizhi" : "/d/bhd/xiongdong",]), 
(["chinese": "冰火岛",
"weizhi" : "/d/bhd/lvyie",]), 
(["chinese": "冰火岛",
"weizhi" : "/d/bhd/yanshi",]), 

/*
(["chinese": "桃花岛",
"weizhi" : "/d/thd/liandanfang",]), 
(["chinese": "桃花岛",
"weizhi" : "/d/thd/jingshe",]), 
(["chinese": "桃花岛",
"weizhi" : "/d/thd/hill2",]), 
(["chinese": "归云庄",
"weizhi" : "/d/taohua/zhangqian",]), 
(["chinese": "归云庄",
"weizhi" : "/d/taohua/qianyuan1",]), 
(["chinese": "归云庄",
"weizhi" : "/d/taohua/hubinlu1",]), 
*/
(["chinese": "天龙寺",
"weizhi" : "/d/tls/wuwujing",]), 
(["chinese": "天龙寺",
"weizhi" : "/d/tls/jietan",]), 
(["chinese": "天龙寺",
"weizhi" : "/d/tls/yaotai",]), 
(["chinese": "华山",
"weizhi" : "/d/huashan/qianchi",]), 
(["chinese": "华山",
"weizhi" : "/d/huashan/shaluo",]), 
(["chinese": "华山",
"weizhi" : "/d/huashan/yuquan",]), 
(["chinese": "雪山",
"weizhi" : "/d/xuedao/sroad4",]), 
(["chinese": "雪山",
"weizhi" : "/d/xueshan/caoyuan",]), 
(["chinese": "雪山",
"weizhi" : "/d/xueshan/kedian",]), 
(["chinese": "襄阳",
"weizhi" : "/d/xiangyang/dongdajie1",]), 
(["chinese": "襄阳",
"weizhi" : "/d/xiangyang/dongdajie3",]), 
(["chinese": "襄阳",
"weizhi" : "/d/xiangyang/minju1",]), 
(["chinese": "逍遥",
"weizhi" : "/d/xiaoyao/qingcaop",]), 
(["chinese": "逍遥",
"weizhi" : "/d/xiaoyao/muwu1",]), 
(["chinese": "逍遥",
"weizhi" : "/d/xiaoyao/muwu2",]), 
(["chinese": "慕容",
"weizhi" : "/d/mr/keting",]), 
(["chinese": "慕容",
"weizhi" : "/d/mr/c13-1",]), 
(["chinese": "慕容",
"weizhi" : "/d/mr/c13-2",]), 
(["chinese": "少林",
"weizhi" : "/d/shaolin/shijie1",]), 
(["chinese": "少林",
"weizhi" : "/d/shaolin/shijie5",]), 
(["chinese": "少林",
"weizhi" : "/d/shaolin/shijie8",]), 
(["chinese": "灵鹫",
"weizhi" : "/d/lingjiu/damen",]), 
(["chinese": "灵鹫",
"weizhi" : "/d/lingjiu/yan",]), 
(["chinese": "灵鹫",
"weizhi" : "/d/lingjiu/shanjiao",]), 
(["chinese": "红花会",
"weizhi" : "/d/honghua/damen",]), 
(["chinese": "红花会",
"weizhi" : "/d/honghua/xinxin-xia",]), 
(["chinese": "红花会",
"weizhi" : "/d/honghua/caoyuan",]), 
//(["chinese": "丐帮",
//"weizhi" : "/d/gaibang/inhole",]), 
(["chinese": "丐帮",
"weizhi" : "/d/city/pomiao",]), 
(["chinese": "昆仑",
"weizhi" : "/d/kunlun/klshanlu",]), 
(["chinese": "昆仑",
"weizhi" : "/d/kunlun/kekexili",]), 
(["chinese": "昆仑",
"weizhi" : "/d/kunlun/bayankala",]), 
(["chinese": "昆仑",
"weizhi" : "/d/kunlun/shanjiao",]), 
(["chinese": "白驼",
"weizhi" : "/d/baituo/menlang",]), 
(["chinese": "白驼",
"weizhi" : "/d/baituo/yuanzi",]), 
(["chinese": "白驼",
"weizhi" : "/d/baituo/damen",]), 
(["chinese": "大理",
"weizhi" : "/d/dali/shizilukou",]), 
(["chinese": "大理",
"weizhi" : "/d/dali/xiaodao2",]), 
(["chinese": "大理",
"weizhi" : "/d/dali/feilihu",]), 
(["chinese": "大理",
"weizhi" : "/d/dali/longkou",]), 
(["chinese": "大理",
"weizhi" : "/d/dali/hexi",]), 
});

void init()
{
        add_action("do_jie", ({"xian","jie"}));
     
}

int do_jie(string arg)
{
        object me, ob;
        mapping weizhis, target;
//      string  weishis;
        int exp, position;

        if(!arg) return 0;
        me = this_player();
        ob = this_player(); 
        exp=(int)me->query("combat_exp"); 
        weizhis = wheres[random(sizeof(wheres))];

        if(arg != "wenshu" && arg != "wen") return 0;

        if(me->query_condition("gb_mission") || me->query_condition("gb_busy"))
                return notify_fail("你现在正忙着做其他任务呢！\n");
        if(me->query_condition("guanfu_task"))
                return notify_fail("你已经揭过榜了，难道不想做了？！\n");
        if(me->query_temp("guanfu_task") || present("wen shu", me))
        return notify_fail("你身上还有文书，可以通过(kan wen shu)来查询。\n");
        
        if(me->query_condition("gf_busy"))
        return notify_fail("你发现文书已经被人揭光了，看样子要等一会了！\n");

           if(exp<1000000)
                return notify_fail("你刚想伸手，忽然看到上面凶神恶煞的画像，想了想觉得自己的这点功夫，还是算了吧。\n"); 
        if(exp>=5000000) position=5;
        else if(exp>=4000000) position=4;
        else if(exp>=3000000) position=3;
        else if(exp>=2000000) position=2;
        else position=1;
        target = quest[position-1][random(sizeof(quest[position-1]))]; 
        while (sizeof(filter_array(children(target["where"]), (: clonep :))) > 0)
        target = quest[position-1][random(sizeof(quest[position-1]))];
        
        if(exp>=3000000){
        tell_room(this_object(),
                HIY + me->name()
                + "信步走到程药发身前,微微睁开眼睛，冷冷瞥了一眼铁捕公文，随手接了下来揣进了怀中。\n"NOR, ({ me }));
        write(HIY"你信步走到程药发身前,微微睁开眼睛，冷冷瞥了一眼铁捕公文，随手接了下来揣进了怀中。\n"NOR);
         }
        if(exp<=2000000){
        tell_room(this_object(),
                 HIY + me->name()
                 + "壮了壮胆，来到程药发身前深深吸了口气，竭力镇定一下紧张的心情，用颤抖的双手把铁捕公文接了过来。\n"NOR, ({ me }));
        write(HIY"你壮了壮胆，来到程药发身前深深吸了口气，竭力镇定一下紧张的心情，用颤抖的双手把铁捕公文接了过来。\n"NOR);
         }
        if(exp>2000000 && exp<3000000){
        tell_room(this_object(),
                 HIY + me->name()
                 + "缓步走到程药发身前，嘴角微微一翘，神态自如的把铁捕公文接了过来。\n"NOR, ({ me }));
        write(HIY"你缓步走到程药发身前，嘴角微微一翘，神态自如的把铁捕公文接了过来。\n"NOR);
        }
        me->set_temp("mark/gkill1",1);
        me->set_temp("guanfu_target", target["name"]);
        me->set_temp("path_rooms", target["where"]);
        me->set_temp("gstart_rooms", weizhis["weizhi"]);
        me->set_temp("ch_weizhi", weizhis["chinese"]);
        new("/quest/gfjob/wenshu1")->move(me);
        ob = new(me->query_temp("path_rooms"));
        ob->move(me->query_temp("gstart_rooms"));
        me->apply_condition("guanfu_task", me->set_temp("guanfu_time", random(70)+20));
        me->apply_condition("gf_busy", random(10)+10);
        
        return 1;
}

